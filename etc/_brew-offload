#compdef brew-offload

_brew-offload() {
    local context state line
    typeset -A opt_args

    _arguments -C \
        '(-h --help)'{-h,--help}'[display help information]' \
        '1: :->subcommand' \
        '2: :->arg1' \
        '3: :->arg2'
    
    case $state in
        subcommand)
            local -a subcmds
            subcmds=(
                'add:Add a formula to the offload list (move it to the offload cellar and create a symlink)'
                'remove:Remove a formula from the offload list (restore it from the offload cellar back to the Homebrew cellar)'
                'config:Manage brew-offload settings (e.g. set `offload_cellar` path)'
            )
            _describe -t commands 'subcommands' subcmds
            ;;
        arg1)
            case $line[1] in
                add)
                    local -a formulae
                    formulae=()
                    compadd -a formulae
                    ;;
                remove)
                    local -a formulae
                    formulae=()
                    compadd -a formulae
                    ;;
                config)
                    local -a keys
                    keys=(
                        'offload_cellar:The absolute path to the directory where offloaded formulae are stored'
                        # add other keys
                    )
                    _describe -t keys 'keys' keys
                    ;;
            esac
            ;;
        arg2)
            case $line[1] in
                config)
                    case $line[2] in
                        offload_cellar)
                            _files -/
                            ;;
                    esac
                    ;;
            esac
    esac
}
