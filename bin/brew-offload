#!/usr/bin/env python3

import argparse
import subprocess
import sys

class BrewOffload:
    def __init__(self, args: list[str]) -> None:
        self.args = arg_parse(*args)
    
    def execute(self) -> int:
        return 0

    def execute_original_brew(self, original_brew_args: list[str]) -> int:
        completedProcess = subprocess.run(
            ["brew"] + original_brew_args,
            stdout=None, stderr=None
        )

        return completedProcess.returncode

        

def arg_parse(*args: str) -> argparse.Namespace:
    parser = argparse.ArgumentParser()
    
    parser.add_argument("wrapped")
    parser.add_argument("remainder", nargs=argparse.REMAINDER)
    namespace = parser.parse_args(args[1:])
    if namespace.wrapped == "wrapped":
        parser = argparse.ArgumentParser(prog="brew")
        parser.add_argument("offload")
        parser.add_argument("remainder", nargs=argparse.REMAINDER)
        namespace_offload = parser.parse_args(namespace.remainder)
        if namespace_offload.offload == "offload":
            parser = argparse.ArgumentParser(prog="brew offload")
            subparsers = parser.add_subparsers(title="subcommands")
            subparsers.add_parser("add").set_defaults(subcommand="add")
            subparsers.add_parser("remove").set_defaults(subcommand="remove")
            result = parser.parse_args(namespace_offload.remainder)
            result.offload = True
        else:
            result = argparse.Namespace()
            result.offload = False
            result.original_brew_args = namespace.remainder
    else:
        parser = argparse.ArgumentParser(prog="brew-offload")
        subparsers = parser.add_subparsers(title="subcommands")
        subparsers.add_parser("add").set_defaults(subcommand="add")
        subparsers.add_parser("remove").set_defaults(subcommand="remove")
        result = parser.parse_args(args[1:])
        result.offload = True

    return result

def main() -> int:
    brew_offload = BrewOffload(sys.argv)
    if brew_offload.args.offload:
        pass
    else:
        return brew_offload.execute_original_brew(brew_offload.args.original_brew_args)
    return 1

if __name__ == "__main__":
    exit(main())
